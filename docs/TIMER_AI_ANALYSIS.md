# 定时AI分析功能使用说明

## 功能概述

定时AI分析功能允许用户设置自动化的AI分析任务，系统会按照设定的时间间隔自动执行AI分析，生成海报图片并推送到Telegram。

## 主要功能

### 1. 定时器设置
- **启用/禁用**: 通过开关控制定时器状态
- **时间间隔**: 支持15分钟到24小时的多种间隔选项
- **实时状态**: 显示当前定时器状态和下次运行时间

### 2. AI分析自动化
- 自动执行ATM波动率期限结构分析
- 生成专业的分析报告
- 包含核心统计指标、期限结构特征、市场情绪洞察、风险提示和AI操作建议

### 3. 海报图片生成
- 自动生成800x600像素的分析海报
- 包含渐变背景和专业的视觉设计
- 显示核心数据指标和AI分析摘要

### 4. Telegram推送
- 自动将分析海报推送到指定的Telegram聊天
- 支持个人聊天和群组推送
- 包含时间戳和AI标识

## 使用步骤

### 1. 获取Telegram Bot Token
1. 在Telegram中搜索 `@BotFather`
2. 发送 `/newbot` 命令创建新机器人
3. 按提示设置机器人名称和用户名
4. 获取Bot Token（格式：`123456789:ABCdefGHIjklMNOpqrsTUVwxyz`）

### 2. 获取Chat ID
#### 个人聊天ID
1. 向你的机器人发送任意消息
2. 访问：`https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getUpdates`
3. 在响应中找到 `"chat":{"id":123456789}` 中的数字

#### 群组聊天ID
1. 将机器人添加到群组
2. 在群组中发送消息
3. 访问上述URL获取群组ID（通常为负数）

### 3. 配置定时器
1. 点击ATM波动率期限结构组件右上角的闹钟图标
2. 在设置模态框中：
   - 启用定时分析开关
   - 选择合适的时间间隔
   - 输入Bot Token和Chat ID
   - 点击保存设置

### 4. 监控运行状态
- 闹钟图标变为绿色表示定时器已启用
- 查看浏览器控制台日志了解运行状态
- 在Telegram中接收自动推送的分析报告

## 技术特性

### 前端功能
- **Canvas图片生成**: 使用HTML5 Canvas生成高质量海报
- **定时器管理**: 基于setInterval的精确定时控制
- **状态持久化**: 定时器状态在组件生命周期内保持
- **错误处理**: 完善的错误处理和用户反馈

### 后端支持
- **Telegram API代理**: 避免CORS问题的后端代理
- **图片处理**: 支持base64图片数据的处理和转换
- **安全传输**: 通过HTTPS安全传输敏感信息

### 数据流程
1. 定时器触发 → 2. 执行AI分析 → 3. 生成海报图片 → 4. 推送到Telegram

## 注意事项

### 安全考虑
- Bot Token是敏感信息，请妥善保管
- 建议使用环境变量存储Bot Token
- 定期更换Bot Token以提高安全性

### 使用限制
- 定时器在页面刷新后会重置
- 需要保持浏览器标签页打开
- 建议在服务器端实现持久化定时任务

### 最佳实践
- 选择合适的分析间隔，避免过于频繁
- 定期检查Telegram推送状态
- 监控AI分析质量，必要时调整参数

## 故障排除

### 常见问题
1. **定时器不工作**: 检查是否启用了定时器，查看控制台日志
2. **Telegram推送失败**: 验证Bot Token和Chat ID是否正确
3. **图片生成失败**: 检查浏览器是否支持Canvas API
4. **AI分析失败**: 确认数据源正常，检查网络连接

### 调试方法
- 查看浏览器开发者工具的控制台
- 检查网络请求状态
- 验证Telegram Bot权限设置

## 扩展功能

### 未来计划
- 服务器端定时任务持久化
- 多种推送渠道支持（微信、钉钉等）
- 自定义海报模板
- 分析结果数据导出
- 多币种支持

### 自定义配置
- 支持自定义分析参数
- 可配置的推送内容格式
- 灵活的时间间隔设置
- 多目标推送支持 