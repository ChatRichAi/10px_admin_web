# 用户资料同步功能

## 功能概述

登录后，用户可以在个人设置页面中查看和同步账号信息。这个功能允许用户：

- 查看完整的账号信息
- 编辑个人资料（姓名、简介、位置等）
- 实时同步数据到数据库
- 查看订阅状态和注册信息

## 功能特性

### 1. 自动数据同步
- 登录后自动从API获取用户信息
- 表单字段自动填充用户数据
- 支持实时数据刷新

### 2. 可编辑字段
- **显示名称**: 用户在应用中显示的名称
- **全名**: 用户的完整姓名
- **位置**: 用户所在地理位置
- **个人简介**: 用户的自我介绍（最多500字符）
- **个人网站**: 用户的个人网站地址
- **Twitter**: 用户的Twitter用户名

### 3. 只读信息
- **邮箱地址**: 不可修改的注册邮箱
- **订阅计划**: 当前的订阅级别（免费版/标准版/专业版）
- **账号状态**: 账号激活状态
- **注册时间**: 账号创建时间

### 4. 交互功能
- **保存更改**: 将修改的信息同步到数据库
- **刷新页面**: 重新加载最新数据
- **错误处理**: 显示保存失败或网络错误信息
- **成功提示**: 保存成功后显示确认消息

## 使用方法

### 访问个人设置
1. 登录账号后，点击侧边栏的"设置"菜单
2. 在设置页面中选择"个人设置"选项
3. 系统会自动加载您的账号信息

### 编辑个人信息
1. 在个人资料表单中修改相应字段
2. 填写完成后点击"保存更改"按钮
3. 系统会验证输入并保存到数据库
4. 保存成功后会显示确认消息

### 查看账号信息
在页面底部的"账号信息"区域可以查看：
- 注册使用的邮箱地址
- 当前的订阅计划类型
- 账号的激活状态
- 账号的注册时间

## 技术实现

### API 端点
- `GET /api/user/profile` - 获取用户资料
- `PUT /api/user/profile` - 更新用户资料

### 数据验证
- 姓名：不能为空，最多50字符
- 个人简介：最多500字符
- 网站地址：最多200字符
- Twitter用户名：最多100字符

### 错误处理
- 网络连接错误
- 服务器错误
- 输入验证错误
- 权限验证错误

## 安全特性

- 基于NextAuth.js的会话验证
- 服务端数据验证
- 敏感信息过滤（不返回密码等）
- CSRF保护

## 开发者信息

### 相关文件
- `templates/SettingsPage/Profile/index.tsx` - 个人资料页面组件
- `hooks/useUserProfile/` - 用户资料管理Hook
- `app/api/user/profile/route.ts` - 用户资料API
- `lib/user-service.ts` - 用户服务后端逻辑
- `types/user.ts` - 用户类型定义

### 自定义Hook
`useUserProfile()` Hook提供：
- `profile`: 用户资料数据
- `isLoading`: 加载状态
- `isSaving`: 保存状态
- `error`: 错误信息
- `updateProfile()`: 更新资料函数
- `fetchProfile()`: 获取资料函数
- `clearError()`: 清除错误函数 